# CLAUDE.md — 项目规则配置与工作流（可复用模板）

更新时间：2025-10-01

本文件用于在任意新项目中为 Claude Code（或同类 IDE 内 AI 助手）提供统一的“行为准则 + 产出物模板 + 工作流约束”。复制本文件到项目根目录即可生效（如存在全局规则 `~/.claude/CLAUDE.md`，则项目内文件优先生效）。

—

## 适用方式
- 放置于项目根目录：`/CLAUDE.md`。
- 层级覆盖：全局 `~/.claude/CLAUDE.md` < 项目 `CLAUDE.md` < 子目录 `.claude.md`。
- 自定义区：文末“项目自定义”可按技术栈/目录结构进行个性化补充。

快捷导航：
- 知识库总览：`ClaudeCodeRules/README.md`
- 快速索引：`ClaudeCodeRules/Quick_Index.md`

—

## 助手行为准则（通用）
- 渐进式修改：变更要小、可审阅、可回滚；先提出方案与影响面，再动手实现。
- 计划先行：工作量非单一步骤时，先给出精炼 TODO 计划并逐步更新。
- 对齐上下文：变更前阅读相关文件与接口定义；避免拍脑袋假设，不足处主动提问。
- 风险与回滚：每次方案需包含边界、失败面、回滚/降级策略。
- 文档留痕：涉及行为/数据/接口变更需同步更新 `PRD.md` 或 `docs/` 说明。
- 样式一致：遵循现有代码风格与目录命名；避免无关重构和大搬家。
- 错误处理：重要路径要有异常处理与日志；不要吞错。
- 测试优先：新增/变更的关键逻辑提供最小可行测试或使用说明；可测试处尽量可测。
- 文件引用：回答中引用具体文件使用可点击路径（逐行不跨范围）。

—

## 0→1 交付流程（Spec Coding）
目标：从愿景到可执行 PRD 与实现蓝图，确定清晰 MVP 范围。

输出清单（DoD）：
- 产品路线图（Mission/Persona/MVP/Future Releases）。
- 关键业务逻辑（Business Rules）。
- 数据契约（Data Contract）。
- MVP 原型（3 份 ASCII 概念稿，覆盖主路径与异常态）。
- 架构设计蓝图（Mermaid 流程/时序 + 组件交互 + 技术选型与风险）。
- `PRD.md`（整合定稿）。

流程要点：
1) 需求澄清：角色、场景、边界、异常、非功能需求（性能/安全/合规）。
2) MVP 切分：第一性功能与可延后功能明确，延后标注 V2+。
3) 路线图：四段式结构，粒度到“用户可感知的能力”。
4) 规则与契约：输入/处理/输出/约束；实体/字段/类型/权限/留痕。
5) 原型 3 选 1：差异化信息结构，标注状态（空/载/错）。
6) 架构蓝图：1 张 Mermaid + 受影响模块 + 技术选型与风险与回滚。
7) 确认与存档：评审通过后生成/更新 `PRD.md`。

0→1 启动 Prompt（可直接粘贴）：
> 你将扮演首席产品设计师，围绕我的愿景完成可执行 PRD。请依次完成：需求澄清→MVP/后续切分→产品路线图（Mission/Persona/MVP/Future Releases）→业务规则（Business Rules）→数据契约（Data Contract）→3 份 MVP ASCII 原型→架构设计蓝图（Mermaid + 组件交互 + 技术选型与风险）。确认后请汇总为 PRD.md。信息不足请穷尽式提问，严禁武断假设。

—

## 持续迭代流程（Plan Mode → Danger Mode）
产出：方案说明 + ASCII 原型（变更部分）+ 技术方案（接口/数据/迁移/边界/风险/回滚）+ 测试计划 + `PRD.md` 顶部“版本更新”。

Plan Mode 模板：
> {口述需求/bug/约束}。请给出最小影响面的解决方案，并用 ASCII 绘制涉及到的原型（界面/流程/数据），列出受影响模块与文件、接口或数据变更；检查不影响非相关模块且能完整满足需求；补充技术方案（接口/数据/迁移/兼容性/边界/风险/回滚）与测试计划（关键用例/回归范围/验收标准）。

Danger Mode 模板：
> 采用方案：{最终方案摘要}，版本号设为 {x.y.z}。再次检查可行性与影响面；若可行：1) 在 PRD.md 顶部新增“版本更新”（变更摘要/ASCII 原型/架构与要点更新）2) 将实现拆解为有序 TODO 并执行 3) 完工后进行自检与回归，输出结果。

迭代质量门（DoD）：
- 无意外影响面：未修改模块行为保持不变。
- 关键用例 + 回归范围通过（含异常路径）。
- 接口/数据/迁移与 PRD 一致并留痕。
- PRD.md 顶部新增“版本更新”区块，内容完整。
- 可回滚：提供回滚步骤或热修策略。

—

## PRD 纲要（可复制使用）
```
# 版本更新（Changelog）
# 核心目标（Mission）
# 用户画像（Persona）
# V1：MVP
# V2+：Future Releases
# 关键业务逻辑（Business Rules）
# 数据契约（Data Contract）
# MVP 原型（选定稿，ASCII）
# 备选原型 A/B/C（ASCII）
# 架构设计蓝图（Mermaid 流程/时序）
# 组件交互说明
# 技术选型与风险
# 测试计划
# 版本与回滚
```

Mermaid 模板（示例）：
```
flowchart LR
  U[User] --> FE[Frontend]
  FE --> API[Backend API]
  API --> DB[(Database)]
  API -- Webhook --> EXT[External Service]
  FE -- Auth --> API
```

```
sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant API as Backend API
  participant DB as Database
  U->>FE: 提交登录表单
  FE->>API: POST /login {email, pwd}
  API->>DB: 查询用户/校验密码
  DB-->>API: 用户记录/校验结果
  API-->>FE: 200 {token}
  FE-->>U: 跳转到仪表盘
```

—

## 代码修改原则（工程约定）
- 变更粒度：一次只做一件事；跨模块改动拆分为多次提交。
- 命名与结构：遵循现有目录与命名；新增模块时在 PRD/文档中登记路径与职责。
- 错误与日志：接口/核心流程加错误处理与必要日志；返回值/异常要明确。
- 配置与密钥：敏感信息走环境变量与密钥管理；代码中不硬编码。
- 依赖与版本：新增依赖需说明用途与锁定范围；谨慎升级。
- 文档与脚本：新增命令/迁移/脚本需有最小使用说明或帮助信息。

—

## 知识卡片模式（可选）
适用于“把规范/约定/研究结论沉淀为卡片可复用”的场景。建议统一为 JSONL（一行一条）。

卡片字段建议：
```
{
  "id": "card-001",
  "type": "card",
  "title": "标题",
  "tags": ["spec", "rule"],
  "content_lines": ["要点1", "要点2"],
  "source": "可选：本地/URL/文件",
  "source_url": "可选",
  "version": "v1",
  "created_at": "YYYY-MM-DD"
}
```

使用建议：
- 项目内唯一权威文件：`notes/xxx_cards.jsonl`（避免多处重复维护）。
- 外部资料另存为 HTML → 转 txt → 摘要为卡片写入 `notes/xxx_cards.jsonl`。
- 如需导出汇编到整合文本，可将卡片摘要拼接在项目的 `docs/compiled.txt`（可自定义）。

—

## 关键词研究流水线（可选模块）
适用：有投放/内容选题决策需求的项目。若不需要，可删除本节。

数据字典（期望列名，脚本可映射同义）：
- `keyword`（必填）、`monthly_coverage`、`trend_change`、`keyword_length`、`dropdown_count`、`消费指数`、`词备注`、`最大年龄占比`、`最大城市占比`
- 小红书扩展：`combined_volume_trend`、`weekly_avg`、`competition_level`、`cpc`

打分（默认权重，可在项目配置中覆盖）：
- volume 0.4, trend 0.2, dropdown 0.2, consume 0.2；可扩展 competition/cpc。

产出（示例）：
- `cleaned.csv`, `opportunities_topN.csv`, `by_age.csv`, `by_city.csv`, `scatter_volume_trend.png`, `hist_volume.png`, `bar_top20.png`

—

## 快速提示词库（精简）
- 代码修复：
  - “请定位并修复 {问题描述} 的根因，给出最小影响面方案，说明受影响模块与回归范围，并附最小测试或验证步骤。”
- 性能优化：
  - “针对 {热点路径/接口}，请提供可量化的优化方案（前后对比指标、风险、回滚），先在 PRD.md ‘版本更新’中登记。”
- 接口变更：
  - “请在不破坏向后兼容的前提下，设计 {接口} 的扩展方案，列出迁移期兼容策略与废弃时间线。”
- 文档生成：
  - “请按照 PRD 纲要补齐缺失章节，并校验与代码/接口的一致性。”

—

## 项目自定义（请在新项目落地时补充/修改）
- 技术栈与工具：
  - 语言/运行时：<例如 Node.js 20 / Python 3.11 / Go 1.22>
  - 包管理器：<例如 pnpm / pip-tools>
  - 框架：<例如 React 18 / FastAPI / Spring Boot>
  - 样式/UI：<例如 Tailwind CSS>
- 目录结构（示例）：
  - `src/` 源码、`api/` 接口、`docs/` 文档、`migrations/` 数据迁移、`scripts/` 工具脚本
- 代码规范：
  - 缩进/引号/分号/最大行宽/命名风格等（按项目约定填写）
- 必要脚本：
  - 开发：`<命令>`；测试：`<命令>`；构建：`<命令>`；质量：`<命令>`
- 安全与合规：
  - 依赖白名单/漏洞扫描/隐私与日志脱敏/密钥管理

—

## 执行承诺（AI 助手自检）
在执行前后，请始终自检：
- 是否按 Plan → Danger 的节奏推进？
- 是否最小影响面、可回滚？
- 是否同步更新了 PRD/文档？
- 是否给出了验证步骤或测试要点？
- 是否对不确定点发问并记录？

—

## 增强条款（填充内容 · 默认生效，可在项目版 CLAUDE.md 局部覆盖）

### 1) Prompt 与对话规范（新增）
- 内容：先目标与约束，后产物格式；限制每轮任务粒度；要求“输出前自检与差异说明”。
- 作用：稳定 Claude 的思考轨迹，减少无关输出与跑偏。
- 负面影响：前置信息更冗长；首次迭代速度略降，但整体收敛更快。

### 2) 工程约束（命名/结构/日志/错误/边界）
- 内容：遵循 03_Best_Practices；新增“任何新增导出/对外接口必须在文档或注释标注契约与示例”。
- 作用：提升可维护性与团队协作一致性。
- 负面影响：初期编码负担上升；需要适应统一风格。

### 3) 安全与合规（默认红线）
- 内容：禁止硬编码密钥/令牌/账号；严禁回显敏感数据；默认开启输入校验与输出净化。
- 作用：降低数据泄漏与注入风险；安全默认开启。
- 负面影响：开发时需处理更多错误分支；Demo 可能显得“啰嗦”。

### 4) 性能预算与监控（轻量版）
- 内容：约定页面首屏 <2.5s、后端 P50 <200ms；脚本循环 O(n) 优先；新增日志埋点建议。
- 作用：避免无意识的性能退化；便于后期排障。
- 负面影响：早期需写额外度量与日志；对快速原型略有拖拽。

### 5) 质量门（DoD 扩展）
- 内容：每个任务需满足“可运行/可回滚/可复盘”三要素；至少 1 个验证步骤或最小测试。
- 作用：交付可验证，连续迭代不劣化。
- 负面影响：一次性输出大段代码难以通过；需要分步。

### 6) 变更管理与回滚
- 内容：功能开关或灰度开关优先；跨表/跨接口变更先写迁移与回滚说明（docs 或注释）。
- 作用：降低回滚成本与变更失败面。
- 负面影响：多写一些保护性代码与文档。

### 7) 测试与验证基线
- 内容：新增关键逻辑提供最小测试或验证脚本；接口给 2 个等价类用例；异常路径至少 1 条。
- 作用：降低回归风险；让 Claude 更容易“自证”。
- 负面影响：短期编码量上升；需要跑一次验证。

### 8) 可观测性与日志
- 内容：统一日志格式（level/traceId/context），严禁打印敏感信息；错误分类（用户/系统/网络/依赖）。
- 作用：线上问题更容易定位；方便复盘与监控。
- 负面影响：代码多一些模板化日志；本地输出更“吵”。

### 9) 依赖与版本策略
- 内容：新增依赖需说明用途；锁版本小版本；安全扫描与许可检查（可后置到 CI）。
- 作用：减少供应链风险与“突然坏掉”。
- 负面影响：引入依赖变慢；版本升级需要评审。

### 10) 数据与隐私（PII）
- 内容：PII 加密或脱敏；导出/日志/排障信息默认去标识化；数据驻留与最小化原则。
- 作用：降低隐私与合规风险。
- 负面影响：调试信息更少；需要额外授权流程访问明文。

### 11) 代码审查模板（简版）
- 内容：Checklist（逻辑/边界/风格/性能/安全/可回滚/文档同步），发现问题按“问题→建议→影响级别”输出。
- 作用：提升 PR 审查质量，一致的改进建议。
- 负面影响：审查时间稍升；初学者需要培训成本。

### 12) 风险清单与灰度开关模板
- 内容：在 PRD/变更说明里附“风险清单（触发条件/影响面/回滚路径/热修策略）”；代码侧预留 feature flag。
- 作用：让变更更可控；方便 A/B 或快速止血。
- 负面影响：需要维护开关生命周期与清理策略。

### 13) 常见失败模式的应对
- 内容：指令漂移→/clear 并重述约束；幻觉→要求“引用出处/文件路径”；过时 API→先读官方变更记录。
- 作用：降低大模型常见问题；更稳地产出可用代码。
- 负面影响：每轮对话多一步“确认/引用校验”。

### 14) 工作流选择指南（外包式/迭代/调试）
- 内容：
  - 外包式：新项目/大改动→先计划后执行；适合多人协同。
  - 迭代：日常功能实现→小步快跑，交付有节奏。
  - 调试闭环：出现异常→按五步循环保障复现/修复/复测/总结。
- 作用：用对方法，效率显著提升。
- 负面影响：需要正确识别场景并切换节奏。

—

## 常用模板（可直接复制使用）

### A. todo.md（规划）
| 任务 | 目标 | 产出 | 依赖 | 预计 | 成功标准 |
|---|---|---|---|---|---|
| X | 实现… | 文件/接口/脚本 | 上游/数据/配置 | 1–2h | 用例通过/指标达标 |

### B. review.md（复盘/审查）
| 类别 | 问题 | 建议 | 影响级别 |
|---|---|---|---|
| 逻辑/边界/风格/性能/安全 | … | … | P1/P2/P3 |

### C. bug_xxx.md（调试闭环）
- 现象/日志/最小复现
- 可能原因（3 条并排序）
- 选因与修复方案
- 测试用例（2+）与结果
- 总结（类型/触发条件/预防）

### D. 发布与回退剧本（模板）
- 适用：含数据迁移/搜索索引/消息队列/高风险功能切换的发布
- 目标：上线可灰度、异常可快速回退、数据不丢不乱

1) 数据库（Expand→Migrate→Contract）
- Expand：仅做向后兼容改动（加列/表/索引），应用可先读旧写新（必要时双写）
- Migrate：幂等回填脚本（断点续跑/并行/进度表/告警），校验总量/抽样字段一致性
- Contract：确认业务已完全切换后再删旧路径；若需回退，停留在 Expand 态即可

2) 搜索索引（Versioned Index + Alias）
- 构建 index_vN+1，完成回放/增量同步与对账
- 通过别名 index_current 切换至 vN+1，异常即切回 vN

3) 消息队列（Pause/Drain/Idempotent）
- 升级前确保消费者幂等（去重/幂等键）
- 暂停新消费者→处理积压→逐步拉起新版本→监控滞后/错误率
- 回退：暂停新版本→切回旧版本→重放死信/重试队列

4) Feature Flag/灰度（Kill Switch）
- 破坏性变更必须配 flag；金丝雀 1%→10%→50%→全量
- 设定回滚阈值（错误率/延时/Pxx/核心转化），触发即关停

5) 备份/快照与恢复演练
- 数据库/对象存储/索引/队列：版本前快照；季度恢复演练（RTO/RPO）

6) 监控与 go/no-go
- 指标：错误率、P90/P95、可用性、队列积压、索引耗时、回填进度
- 告警：发布窗口加强监控，分级阈值与抖动抑制

7) 发布单检查清单（示例）
| 类别 | 要点 | 负责人 |
|---|---|---|
| 影响面 | 功能/接口/数据/索引/队列/权限 |  |
| 开关策略 | flag 名称/默认值/灰度节奏/回滚阈值 |  |
| 迁移脚本 | 位置/幂等/断点续跑/监控 |  |
| 索引计划 | vN→vN+1 切换/别名/回退 |  |
| 队列计划 | 暂停/排空/重放/死信治理 |  |
| 备份策略 | 对象/时间点/保留周期/演练记录 |  |
| 监控告警 | 指标/阈值/仪表盘链接 |  |
| 回退步骤 | 具体步骤/耗时估计/一致性校验 |  |
| 沟通协调 | 值班/通知渠道/回放窗口 |  |

—

## 与知识库/脚本的衔接
- 投喂→入库：使用 `ClaudeCodeRules/_Feed/` + `ingest_feed.py`，Prompt 会按“规划/执行/复盘”锚点插入；方法论会按“外包式/迭代/调试”路由。
- 生成项目 CLAUDE.md：`python tools/build_claude_md.py --project-name "YourApp" --output your_app/CLAUDE.md`（可调模块组合）。
- 作用：让“碎片→知识库→项目规则”形成闭环；减少从零写规则的时间。
- 负面影响：需要遵从既定结构；在极简 Demo 中显得“流程较重”。

### 参考资料（External Notes）
- Andrew Ng / deeplearning.ai 资料索引：`ClaudeCodeRules/External_Notes/andrew_ng_resources.md`
- 可选离线抓取清单（notes/external_sources.jsonl）+ `python tools/fetch_external.py`

—

## 方法论与策略扩展（Andrew Ng 要点）

### 1) 数据中心方法（Data‑Centric AI）
- 简介：从“调模型”转为“调数据”——系统提升标注一致性/覆盖面/难例质量。
- 作用：更快收敛、改进可复用；数据质量提升往往比加大模型更划算。
- 负面影响：需要标注指南/抽检/仲裁与数据留痕投入，初期时间成本上升。
- 最小清单：
  - 标注一致性：统一指南、抽检复核、一致性度量（如 Cohen’s kappa）
  - 黄金/压力/挑战集：维护高质量评估切片
  - 切片评估：按人群/场景/边界条件做 slice 指标
  - 难例挖掘：错误驱动采样、主动学习
  - 数据版本：数据/标注/指南版本化与溯源
- 建议 Prompt：
  - “基于当前错误样本，输出切片评估方案（切片定义/分布/当前得分/改进建议），并给出黄金/压力集与标注指南修订项。”

### 2) 机器学习策略（ML Strategy）
- 简介：单一指标、快速基线、结构化误差分析与正交化调优。
- 作用：先快后优，减少盲调；用数据驱动优先级与收益评估。
- 负面影响：短期可能牺牲局部最优以换整体节奏；需要严格评测纪律。
- 最小清单：
  - 单一评估指标（便于比较）；快速建立 baseline
  - 偏差/方差分析，针对性方案（正则/增数据/早停等）
  - 误差标签→收益/代价评估→优先级排序
  - 线上监控 drift 与回归检查表
- 建议 Prompt：
  - “请基于当前指标与错误分布，输出 ML Strategy：指标/基线/误差分析/优先级/预期收益，并给出两轮迭代与回归表。”

### 3) MLOps 生命周期（版本化→评估/监控→部署/回滚→回训）
- 简介：数据/特征/模型/代码/配置全链路版本；影子/金丝雀/AB；回滚与热切换；回训闭环。
- 作用：可复现、可回溯、可监控、可回训；与安全/回退剧本协同保障可控性。
- 负面影响：需要建设特征库/模型仓/仪表盘与流程，初期工程成本增加。
- 最小清单：
  - 版本化：数据/特征/模型/代码/配置
  - 评估：离线评估 + 线上监控（drift/性能/稳定性）
  - 部署：影子/金丝雀/AB 与回滚/热切换
  - 回训：定期/触发式回训；offline/online parity 验证
  - 资产：评估报告/仪表盘/告警
- 建议 Prompt：
  - “请给出本项目 MLOps 生命周期蓝图：版本化/评估与监控/部署与回滚/回训计划/仪表盘与告警，并附最小落地清单（工具/文件）。”

### 4) Prompt 工程与 LLM 评估（RAG/评测/对齐）
- 简介：角色/分步推理/少样例/工具/格式约束；RAG 管线与引用；LLM‑as‑judge + 人审闭环。
- 作用：把 Prompt 作为“可复用编程接口”，用评估与人审闭环压制幻觉与漂移。
- 负面影响：建立评估集、rubric 与人审流程需要额外时间与规范。
- 最小清单：
  - Prompt 模板化（角色/输入/输出/约束/评估）
  - RAG：召回/重排/引用出处（grounding）
  - 评估：任务指标 + LLM‑as‑judge + 人审抽检/仲裁
  - Guardrail：敏感场景模板化回复与审计日志
- 建议 Prompt：
  - “请输出当前任务的 Prompt 模板（角色/输入/输出/约束/评估），并给出最小评估集与评分 rubric。”

### 5) Responsible AI（公平/隐私/解释/安全/治理）
- 简介：责任 AI 指标 + 工程与治理流程（留痕/审批/审计）。
- 作用：降低责任/合规风险；把治理纳入工程可执行清单。
- 负面影响：需要定义阈值/审批流/审计留痕，治理成本上升。
- 最小清单：
  - 公平性：群体/个体公平指标与缓解（重加权/对抗/后处理）
  - 隐私：最小化、去标识化、访问控制、合规（GDPR/本地法规）
  - 可解释：SHAP/LIME 与可视化报告
  - 安全：越权/注入防护；敏感任务启用流程
  - 治理：接口/数据/模型变更留痕；审计日志；事后复盘
- 建议 Prompt：
  - “请输出 Responsible AI 检查清单：公平/隐私/可解释/安全/治理指引与阈值，并给出合规与审计流程。”

—

## Claude Code 使用技巧（实战精选）
> 来源：一线使用模式与社区经验；每条含 作用/风险/缓解/相关

- /clear（高频重置）
  - 作用：减少上下文漂移；新任务前清空更稳定
  - 风险：需重复关键信息
  - 缓解：使用 todo/review/bug 模板复用关键信息
  - 相关：Mitigations；Prompt 模板

- 提供完整上下文（含隐含假设与边界）
  - 作用：提升一次命中率；减少来回澄清
  - 风险：提示过长、遗漏隐含语义
  - 缓解：按“目标/约束/边界/示例”四段式；对“现代设计”给对标（如 Linear UI）
  - 相关：02_Prompt_Templates

- Task 子任务（并行深研，角色拆分）
  - 作用：把复杂分析拆给子代理（设计/可访问性/响应式/样式等）并比较
  - 风险：token 消耗；结果发散
  - 缓解：限定产出表头与评分维度；合并前做一页对比
  - 相关：01_Workflow_Methods（迭代）

- “超级思考”（在规划阶段强制更深推理）
  - 作用：让 Claude 先系统思考再执行，降低返工
  - 风险：时间变长
  - 缓解：限制推理大纲长度与层级，先小试
  - 相关：Plan→Code→Review 模式

- Escape×2 分叉 / --resume 线程
  - 作用：快速回到上一条提示，分叉不同方向
  - 风险：分支过多易混乱
  - 缓解：为分支命名并记录在 todo.md；定期收敛
  - 相关：02_Prompt_Templates/planning_prompts.md

- 跳过权限（--dangerously-skip-permissions，谨慎）
  - 作用：长任务少打断；alias yolo 启动
  - 风险：误改范围大、速率限制更频繁
  - 缓解：Git 早存常存；worktree 隔离；仅在可回滚范围内使用
  - 相关：发布与回退剧本；Mitigations

- MCP 服务器（理性取舍）
  - 作用：可扩展工具；但多数场景内置工具已足够
  - 风险：配置/令牌开销大
  - 缓解：仅在确有增益时启用；先评估价值
  - 相关：External Notes（Prompt/工具链）

- SDK & CLI 快捷
  - 作用：把高频动作脚本化（如一键生成 commit 标题）
  - 风险：脚本失效/误用
  - 缓解：加入安全确认与 dry-run；脚本化模板放入 scripts/
  - 相关：03_Best_Practices/file_structure_patterns.md

- 其他模型做规划 + Shift+Tab 规划模式
  - 作用：多视角方案；Claude 规划模式不落盘更安全
  - 风险：方案分歧
  - 缓解：用对比表合并共识后再执行
  - 相关：01_Workflow_Methods/foreign_workflow_template.md

- 先读手册 + Task 深研（示例：Tailwind v3→v4）
  - 作用：避免用旧脚手架；迁移要点先锁定
  - 风险：信息量大
  - 缓解：产出“一页迁移清单”（弃用项/新语法/性能/自动化脚本）
  - 相关：External Notes；发布与回退剧本

- 语音输入（长提示提速）
  - 作用：更快输出草稿；适合需求澄清
  - 风险：转写错误
  - 缓解：用结构化模板复核；关键名词手工校对

- Git 早存常存（快照）
  - 作用：随时回滚；控制误改损失
  - 风险：小步提交较多
  - 缓解：按主题 squashing；在 PR 描述合并说明

- Git worktree（并行试验）
  - 作用：同仓不同目录并行任务，隔离 Claude 的修改
  - 风险：分支与工作树管理复杂
  - 缓解：命名规范 + 清理脚本

- 一次性小工具（automation by default）
  - 作用：临时脚本/转换/分析，大幅提效
  - 风险：沉淀混乱
  - 缓解：放入 scripts/，附用法与示例输入

- 迭代胜过一把梭
  - 作用：先讨论方案再小步更改，验证后扩展到更多组件
  - 风险：看起来不“酷”但更稳
  - 缓解：用里程碑与 DoD 定义每步“可交付”

- 人工监督 + Dev Server 实时校对
  - 作用：基于真实日志/堆栈最小复现；遇错立停/回滚
  - 风险：需要介入
  - 缓解：把监督动作模板化（复制命令与预期日志）

- /terminal-setup 与 /ide 集成
  - 作用：换行/铃声/读取打开文件与 linter；“修复 linter 问题”一键
  - 风险：环境差异
  - 缓解：记录环境差异与本地化脚本

- 自定义斜杠命令 / 图片粘贴
  - 作用：把高频 Prompt 模板固化；图像交互更直观
  - 风险：模板老化
  - 缓解：季度体检；在 Quick Index 登记生效范围

## 负面影响缓解策略（摘要）
> 当规则带来负担时，优先参考此节的“可操作”方案；详见 `03_Best_Practices/mitigations.md`

- Prompt/流程冗长 → 采用 todo/review/bug 模板 + VSCode 任务，减少重复输入。
- 安全与治理成本 → 采用“核心 6 条”最小安全基线；敏感场景模板化回复 + 审计。
- 数据治理开销 → 仅对“高收益切片”做一致性与抽检；每周 30 分钟误差评审会。
- 监控/评估搭建量 → 先做最小指标（错误率/P90/可用性 + 1 个业务指标）。
- 回退流程复杂 → 使用“发布单检查清单”复核（DB/Index/Queue/Flag）；预置 SOP。
- 依赖升级/引入慢 → 白名单 + 批处理小升级；关键依赖锁 minor。
- 日志噪声大 → 统一 logger 封装 + 环境开关（本地降噪，线上详尽）。
